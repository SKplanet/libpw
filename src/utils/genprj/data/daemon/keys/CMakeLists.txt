# Generated by PWGenPrj
# Generated date: __PWTEMPLATE_DATE__

# Generating dummy certs and privatekey for test.
# DO NOT USE THIS OUTPUTS FOR PRODUCTION.

project(__PWTEMPLATE_NAME__.certs)
set(CERT_TARGET __PWTEMPLATE_NAME__.certs)
set(PASSWORD 1111)

add_custom_command(OUTPUT privatekey.key
	COMMAND openssl genrsa -passout pass:${PASSWORD} -des3 -out privatekey.key 1024 2> /dev/null
	COMMENT "${CERT_TARGET}: Generating privatekey"
	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
	)

add_custom_command(OUTPUT privatekey.pem
	COMMAND openssl rsa -passin pass:${PASSWORD} -in ${CMAKE_CURRENT_BINARY_DIR}/privatekey.key -out ${CMAKE_CURRENT_BINARY_DIR}/privatekey.pem 2> /dev/null
	COMMENT "${CERT_TARGET}: Convert privatekey to PEM style"
	DEPENDS privatekey.key
	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
	)

add_custom_command(OUTPUT certificate.pem
	COMMAND openssl req -batch -utf8 -new -x509 -nodes -sha1 -days 365 -key ${CMAKE_CURRENT_BINARY_DIR}/privatekey.pem -out ${CMAKE_CURRENT_BINARY_DIR}/certificate.pem 2> /dev/null
	COMMENT "${CERT_TARGET}: Generating self-signed certificate"
	DEPENDS privatekey.pem
	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
	)

add_custom_command(OUTPUT intermediate.pem
	COMMAND cp ${CMAKE_CURRENT_BINARY_DIR}/certificate.pem ${CMAKE_CURRENT_BINARY_DIR}/intermediate.pem 2> /dev/null
	COMMENT "${CERT_TARGET}: Generating intermediate cert"
	DEPENDS certificate.pem
	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
	)

add_custom_target(${CERT_TARGET} ALL
	DEPENDS intermediate.pem
	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
	)

